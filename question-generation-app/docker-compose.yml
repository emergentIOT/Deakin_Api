version: '3.7'
services:
    ai-qg-app:
      container_name: ai-qg-app
      image: local-des-inno-docker.artifactory.its.deakin.edu.au/ai-qg-app:${ENV_TAG}
      secrets:
        - source: nginx_tls_crt
          target: its.deakin.edu.au.crt
        - source: nginx_tls_key
          target: its.deakin.edu.au.key  
      restart: unless-stopped
      networks:
        - traefik-int
      deploy:
        mode: replicated
        replicas: 1
        labels:
            - "traefik.enable=true"
            - "traefik.docker.network=traefik-int"
            - "traefik.http.routers.ai-qg-app.rule=Host(`des-inno-ai-qg-app.its.deakin.edu.au`)"
            - "traefik.http.routers.ai-qg-app.entrypoints=web"
            - "traefik.http.routers.ai-qg-app.service=ai-qg-app"
            - "traefik.http.services.ai-qg-app.loadbalancer.server.port=8080"

networks:
  traefik-int:
    external: true
    
secrets:
  nginx_tls_crt:
    external: true
  nginx_tls_key:
    external: true
  